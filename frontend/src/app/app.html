<div style="text-align: center; padding: 2rem; max-width: 900px; margin: 0 auto;">
  <h1>🎤 실시간 Whisper STT (WebSocket + VAD)</h1>
  <p style="color: #666; margin-bottom: 2rem;">
    CLI처럼 음성을 자동 감지하여 STT 처리합니다
  </p>

  <!-- 연결 상태 -->
  <div style="margin-bottom: 2rem; padding: 1rem; border-radius: 8px; background-color: #f8f9fa;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
      <div>
        <strong>🔗 연결 상태:</strong> 
        <span [style.color]="connectionStatus === '준비됨' || connectionStatus === '연결됨' ? '#28a745' : connectionStatus === '연결 실패' ? '#dc3545' : '#ffc107'">
          {{ connectionStatus }}
        </span>
      </div>
      <div>
        <strong>⚙️ 처리 상태:</strong> 
        <span [style.color]="processingStatus.includes('✅') ? '#28a745' : processingStatus.includes('❌') ? '#dc3545' : '#007bff'">
          {{ processingStatus || '대기 중' }}
        </span>
      </div>
    </div>
    
    <!-- 디버그 정보 -->
    <div style="margin-top: 1rem; font-size: 12px; color: #666; border-top: 1px solid #ddd; padding-top: 0.5rem;">
      <strong>🔍 디버그:</strong> 
      마이크={{ !!selectedMicId }}, 
      연결상태={{ connectionStatus }}, 
      소켓연결={{ socket?.connected || false }},
      버튼활성화={{ !!selectedMicId && (connectionStatus === '준비됨' || connectionStatus === '연결됨') }}
    </div>
    
    <!-- 세션 통계 -->
    <div *ngIf="isRecording" style="margin-top: 1rem; font-size: 14px; color: #666;">
      <strong>📊 세션 통계:</strong> {{ getSessionStats() }}
    </div>
  </div>

  <!-- 마이크 선택 -->
  <div style="margin-bottom: 2rem;">
    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">
      🎤 마이크 선택:
    </label>
    <select 
      [(ngModel)]="selectedMicId" 
      [disabled]="isRecording"
      style="padding: 8px; font-size: 14px; border-radius: 4px; border: 1px solid #ccc; min-width: 300px;">
      <option value="" disabled>마이크를 선택하세요</option>
      <option *ngFor="let mic of microphones" [value]="mic.deviceId">
        {{ mic.label || '마이크 ' + (microphones.indexOf(mic) + 1) }}
      </option>
    </select>
    <div *ngIf="selectedMicId" style="margin-top: 0.5rem; font-size: 12px; color: #666;">
      선택됨: {{ getSelectedMicName() }}
    </div>
  </div>

  <!-- 제어 버튼 -->
  <div style="margin-bottom: 2rem;">
    <button 
      (click)="isRecording ? stopRecording() : startRecording()"
      [disabled]="!selectedMicId || (connectionStatus !== '준비됨' && connectionStatus !== '연결됨')"
      style="padding: 12px 24px; font-size: 16px; border-radius: 8px; border: none; color: white; cursor: pointer; margin-right: 10px;"
      [style.background-color]="isRecording ? '#dc3545' : '#28a745'"
      [style.opacity]="!selectedMicId || (connectionStatus !== '준비됨' && connectionStatus !== '연결됨') ? '0.5' : '1'">
      {{ isRecording ? '🛑 Stop Streaming' : '🎙 Start Streaming' }}
    </button>

    <button 
      (click)="clearResults()"
      [disabled]="isRecording"
      style="padding: 12px 24px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; background-color: #f8f9fa; color: #333; cursor: pointer;"
      [style.opacity]="isRecording ? '0.5' : '1'">
      🗑️ Clear Results
    </button>
  </div>

  <!-- 실시간 상태 표시 -->
  <div style="margin-bottom: 2rem;">
    <div *ngIf="isRecording" style="padding: 1rem; border-radius: 8px; background-color: #d4edda; border: 1px solid #c3e6cb;">
      <div style="color: #155724; font-weight: bold; margin-bottom: 0.5rem;">
        🔴 실시간 스트리밍 중... 
      </div>
                    <div style="font-size: 12px; color: #155724;">
          • 256ms 간격으로 PCM 데이터 직접 전송<br>
          • ffmpeg 변환 없이 바로 VAD 처리<br>
          • 1.5초 침묵 후 자동으로 문장 완료 감지<br>
          • 최소 0.5초 이상 음성만 STT 처리<br>
          • 총 {{ totalChunks }}개 PCM chunk 전송됨
       </div>
    </div>
    
    <div *ngIf="!isRecording" style="padding: 1rem; border-radius: 8px; background-color: #f8f9fa; border: 1px solid #dee2e6;">
      <div style="color: #6c757d; font-weight: bold; margin-bottom: 0.5rem;">
        💤 대기 중
      </div>
      <div style="font-size: 12px; color: #6c757d;">
        스트리밍을 시작하면 자동으로 음성을 감지하고 STT 처리합니다
      </div>
    </div>
  </div>

  <!-- STT 결과 -->
  <div style="text-align: left;">
    <h3 style="text-align: center; margin-bottom: 1rem;">
      📝 실시간 STT 결과 ({{ totalSTTResults }}개)
    </h3>
    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 1rem; background-color: #f8f9fa; min-height: 300px; max-height: 500px; overflow-y: auto;">
      <div *ngIf="sttResults.length === 0" style="color: #999; text-align: center; padding: 2rem;">
        음성을 감지하면 여기에 텍스트가 나타납니다.<br>
        <small>서버의 VAD가 음성 끝을 자동 감지하여 STT 처리합니다.</small>
      </div>
      
      <div *ngFor="let result of sttResults; let i = index" 
           style="margin-bottom: 10px; padding: 10px; border-radius: 4px; background-color: white; border-left: 3px solid #007bff;">
        <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
          STT 결과 #{{ sttResults.length - i }}
        </div>
        <div style="word-break: break-word;">
          {{ result }}
        </div>
      </div>
    </div>
  </div>

  <!-- 로그 확인 안내 -->
  <div style="margin-top: 2rem; padding: 1rem; border-radius: 8px; background-color: #fff3cd; border: 1px solid #ffeaa7;">
    <div style="color: #856404; font-weight: bold; margin-bottom: 0.5rem;">
      🔍 상세 로그 확인 방법
    </div>
    <div style="font-size: 12px; color: #856404;">
      • <strong>브라우저:</strong> 개발자 도구 (F12) → Console 탭<br>
      • <strong>서버:</strong> Flask 서버 실행 중인 터미널 창<br>
      • 실시간으로 오디오 전송, VAD 감지, STT 처리 과정을 확인할 수 있습니다
    </div>
  </div>

  <!-- 기술 정보 -->
  <div style="margin-top: 2rem; font-size: 12px; color: #666; text-align: left;">
    <strong>📡 기술 구성:</strong><br>
    • WebSocket 실시간 통신 (socket.io)<br>
    • Web Audio API로 PCM 데이터 직접 추출<br>
          • 256ms 단위 PCM chunk 전송 (4096 samples &#64; 16kHz)<br>
    • 서버 VAD (webrtcvad) 음성 감지<br>
    • Whisper STT 자동 처리<br>
    • CLI와 동일한 구조로 구현
  </div>
</div>
